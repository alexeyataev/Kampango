<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Prevent_Overbooking_Of_Course</fullName>
    <active>true</active>
    <description>Prevent further bookings being added to a course if Remaning Places is 0, unless the Allow Overbooking Flag is set.</description>
    <errorConditionFormula>AND(
 OR(IsNew(), 
    AND(IsChanged( Status__c ),  
        OR(ISPICKVAL(PRIORVALUE(Status__c),&#39;Expired&#39;), 
           ISPICKVAL(PRIORVALUE(Status__c),&#39;Cancelled&#39;)), 
        NOT(OR(ISPICKVAL(Status__c ,&#39;Expired&#39;), 
          ISPICKVAL(Status__c,&#39;Cancelled&#39;)))),
    IsChanged( Course__c )),
 Course__r.Remaining_Places__c &lt; 1,  
 Course__r.Overbooking_allowed__c  = FALSE, 
 NOT($Permission.Override_Booking_Validation))</errorConditionFormula>
    <errorMessage>There are currently no remaining places on this course and overbooking has not been allowed by the course administrator.</errorMessage>
</ValidationRule>
