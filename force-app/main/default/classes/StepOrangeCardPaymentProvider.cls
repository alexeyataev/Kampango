public class StepOrangeCardPaymentProvider implements IPaymentServiceProvider {
    private static final String PAYER_CONTACT_UPDATE = 'none';
    private static final String PAYMENT_METHOD = 'Creditcard';
    private static final String SOURCE_CONNECTOR = 'PaymentHub';
    private static final String SUCCESS_PAGE = Parentforce_Community_Settings__c.getOrgDefaults().Base_Url__c + '/s/success';
    private static final String ERROR_PAGE = Parentforce_Community_Settings__c.getOrgDefaults().Base_Url__c + '/s/failure';
    private static final String API_TOKEN = Parentforce_Community_Settings__c.getOrgDefaults().API_Token__c;
    private static final String ORIGIN = 'BookingJourney';
    public static String getCardPaymentURL(String contactId, String installmentId) {
        PaymentApiRequest paymentBody = createPaymentBody(contactId, installmentId);
        String installmentPayRequest = JSON.serialize(paymentBody, true);
        HttpRequest req = new HttpRequest();
        //req.setEndpoint('callout:Step_Orange_Auth');
        req.setEndpoint('callout:Step_Orange_Auth_Anonymous');
        req.setBody(installmentPayRequest);system.debug(installmentPayRequest);
        req.setHeader('Content-Type', 'application/json;charset=UTF-8');
        req.setHeader('api_token', API_TOKEN);
        req.setMethod('POST');
        req.setTimeout(120000);
        Http http = new Http();
        HttpResponse resp = http.send(req);
        cpm.API_Request_Response.PaymentPostRequest request = (cpm.API_Request_Response.PaymentPostRequest)JSON.deserializeStrict(resp.getBody(), cpm.API_Request_Response.PaymentPostRequest.class);
        return request.RedirectURL;
    }
    private static PaymentApiRequest createPaymentBody(String contactId, String installmentId) {
        PaymentApiRequest.Contact contact = new PaymentApiRequest.Contact(contactId);
        PaymentApiRequest.Payer payer = new PaymentApiRequest.Payer(contact, PAYER_CONTACT_UPDATE);
        PaymentApiRequest.Payment payment = new PaymentApiRequest.Payment(installmentId);
        PaymentApiRequest.PaymentMethod paymentMethod = new PaymentApiRequest.PaymentMethod(PAYMENT_METHOD);
        PaymentApiRequest.SourceConnector sourceConnector = new PaymentApiRequest.SourceConnector(SOURCE_CONNECTOR);
        PaymentApiRequest paymentBody = new PaymentApiRequest(SUCCESS_PAGE, ERROR_PAGE, ORIGIN, payer, payment, paymentMethod, sourceConnector);
        return paymentBody;
    }
}
