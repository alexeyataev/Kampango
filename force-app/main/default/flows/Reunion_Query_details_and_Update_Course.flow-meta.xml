<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Set_course_fields</name>
        <label>Set course fields</label>
        <locationX>859</locationX>
        <locationY>609</locationY>
        <assignmentItems>
            <assignToReference>course.Reunion_End__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>session.End_Text__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Start__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>session.Start_Text__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Id__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>session.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Session_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>session.Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Session_Day_Of_Week__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>session.Day_of_Week__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Venue_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>venue.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Venue_Map_Url__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>venue.Map_Url__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Venue_Town__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>venue.Town__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Venue_Street_Address__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>venue.Street_Address__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Practitioner_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>practitioner.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Practitioner_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>practitioner.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Practitioner_Phone__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>practitioner.Phone</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>course.Reunion_Host_Contact_Names__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formula_host_names</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_course</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_contact_not_empty</name>
        <label>Check contact not empty</label>
        <locationX>192</locationX>
        <locationY>458</locationY>
        <defaultConnector>
            <targetReference>Loop_to_find_venue_owners</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_contact_null_false</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>venueContact.Contact__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_if_primary</targetReference>
            </connector>
            <label>Is contact not null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_primary</name>
        <label>Check if primary</label>
        <locationX>422</locationX>
        <locationY>50</locationY>
        <defaultConnector>
            <targetReference>Get_course</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_primary_contact</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>primary_contact</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_contact_as_primary</targetReference>
            </connector>
            <label>Is primary contact empty?</label>
        </rules>
        <rules>
            <name>Is_partner_contact</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>partner_contact_name</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_contact_as_partner</targetReference>
            </connector>
            <label>Is partner contact empty?</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_public_venue</name>
        <label>Check public venue</label>
        <locationX>464</locationX>
        <locationY>807</locationY>
        <defaultConnector>
            <targetReference>Get_venue_owners</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Is private venue</defaultConnectorLabel>
        <rules>
            <name>Is_public_venue</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>session.IsPublicVenue__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_course</targetReference>
            </connector>
            <label>Is public venue?</label>
        </rules>
    </decisions>
    <formulas>
        <name>formula_host_names</name>
        <dataType>String</dataType>
        <expression>{!primary_contact.FirstName} &amp; IF(ISBLANK({!partner_contact_name}), &#39; &#39;, &#39; and &#39; &amp; {!partner_contact_name}) &amp; {!primary_contact.LastName}</expression>
    </formulas>
    <interviewLabel>Reunion Query details and Update Course {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Reunion Query details and Update Course</label>
    <loops>
        <name>Loop_to_find_venue_owners</name>
        <label>Loop to find venue owners</label>
        <locationX>473</locationX>
        <locationY>453</locationY>
        <assignNextValueToReference>venueContact</assignNextValueToReference>
        <collectionReference>venueContactList</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Check_contact_not_empty</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_course</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_contact_as_partner</name>
        <label>Get contact as partner</label>
        <locationX>559</locationX>
        <locationY>225</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_to_find_venue_owners</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>venueContact.Id</elementReference>
            </value>
        </filters>
        <object>Contact</object>
        <outputAssignments>
            <assignToReference>partner_contact_name</assignToReference>
            <field>FirstName</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_contact_as_primary</name>
        <label>Get contact as primary</label>
        <locationX>444</locationX>
        <locationY>259</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_to_find_venue_owners</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>venueContact.Contact__c</elementReference>
            </value>
        </filters>
        <object>Contact</object>
        <outputReference>primary_contact</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>FirstName</queriedFields>
        <queriedFields>LastName</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_course</name>
        <label>Get course</label>
        <locationX>859</locationX>
        <locationY>475</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_course_fields</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <object>Course__c</object>
        <outputReference>course</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Reunion_Is_Ready_To_Send_Emails__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Practitioner</name>
        <label>Get Practitioner</label>
        <locationX>344</locationX>
        <locationY>806</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_public_venue</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>session.Practitioner__c</elementReference>
            </value>
        </filters>
        <object>Contact</object>
        <outputReference>practitioner</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Phone</queriedFields>
        <queriedFields>Email</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Session</name>
        <label>Get Session</label>
        <locationX>207</locationX>
        <locationY>675</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Venue</targetReference>
        </connector>
        <filters>
            <field>Course__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Confirmed</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Reunion</stringValue>
            </value>
        </filters>
        <object>Session__c</object>
        <outputReference>session</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Start_Text__c</queriedFields>
        <queriedFields>End_Text__c</queriedFields>
        <queriedFields>Day_of_Week__c</queriedFields>
        <queriedFields>Date__c</queriedFields>
        <queriedFields>Venue__c</queriedFields>
        <queriedFields>Practitioner__c</queriedFields>
        <queriedFields>IsPublicVenue__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Venue</name>
        <label>Get Venue</label>
        <locationX>209</locationX>
        <locationY>805</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Practitioner</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>session.Venue__c</elementReference>
            </value>
        </filters>
        <object>Venue__c</object>
        <outputReference>venue</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Town__c</queriedFields>
        <queriedFields>Street_Address__c</queriedFields>
        <queriedFields>Map_Url__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_venue_owners</name>
        <label>Get venue owners</label>
        <locationX>474</locationX>
        <locationY>604</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_to_find_venue_owners</targetReference>
        </connector>
        <filters>
            <field>Venue__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>venue.Id</elementReference>
            </value>
        </filters>
        <object>Venue_Contact__c</object>
        <outputReference>venueContactList</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Contact__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Update_course</name>
        <label>Update course</label>
        <locationX>990</locationX>
        <locationY>613</locationY>
        <connector>
            <targetReference>Execute_sending_emails</targetReference>
        </connector>
        <inputReference>course</inputReference>
    </recordUpdates>
    <startElementReference>Get_Session</startElementReference>
    <status>Active</status>
    <subflows>
        <name>Execute_sending_emails</name>
        <label>Execute sending emails</label>
        <locationX>1119</locationX>
        <locationY>613</locationY>
        <flowName>Reunion_Execute_Sending</flowName>
        <inputAssignments>
            <name>sessionId</name>
            <value>
                <elementReference>session.Id</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>output_message</assignToReference>
            <name>output_message</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>output_status</assignToReference>
            <name>subflow_status</name>
        </outputAssignments>
    </subflows>
    <variables>
        <name>course</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Course__c</objectType>
    </variables>
    <variables>
        <name>output_message</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>output_status</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>partner_contact_name</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>practitioner</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>primary_contact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>session</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Session__c</objectType>
    </variables>
    <variables>
        <name>venue</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Venue__c</objectType>
    </variables>
    <variables>
        <name>venueContact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Venue_Contact__c</objectType>
    </variables>
    <variables>
        <name>venueContactList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Venue_Contact__c</objectType>
    </variables>
</Flow>
